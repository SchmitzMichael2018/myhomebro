import{r as e,u as s,j as t,I as a,a as l}from"./index-DaD-43PJ.js";function n(){const[n,r]=e.useState([]),[c,i]=e.useState(!0),[d,o]=e.useState(""),[x,m]=e.useState([]),[h,p]=e.useState(!1),[u,j]=e.useState(""),[g,y]=e.useState(""),[v,N]=e.useState("all"),[b,f]=e.useState("all"),[w,_]=e.useState(!1),[S,C]=e.useState(1),k=s();e.useEffect((()=>{(async()=>{i(!0);try{const{data:e}=await l.get("/projects/agreements/");r(e),o("")}catch(e){o("Failed to load agreements. Please try again later."),r([])}finally{i(!1)}})()}),[]);const A=e.useMemo((()=>n.filter((e=>"active"===v?!e.is_archived:"archived"!==v||e.is_archived)).filter((e=>"funded"===b?e.escrow_funded:"pending"!==b||!e.escrow_funded)).filter((e=>!w||!e.signed_by_contractor)).filter((e=>{var s;if(!g)return!0;return`${e.project_name||e.project_title||""} ${e.homeowner_name||(null==(s=e.homeowner)?void 0:s.name)||""} ${e.id}`.toLowerCase().includes(g.toLowerCase())}))),[n,g,v,b,w]),E=e.useMemo((()=>{const e=10*(S-1);return A.slice(e,e+10)}),[A,S]),P=Math.ceil(A.length/10);return t.jsxs("div",{className:"p-6",children:[t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-4",children:[t.jsx("h2",{className:"text-2xl font-semibold text-gray-800",children:"Agreements"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("input",{type:"text",placeholder:"Search by project, homeowner, or ID...",value:g,onChange:e=>{y(e.target.value),C(1)},className:"border px-3 py-2 rounded shadow-sm"}),t.jsxs("select",{value:v,onChange:e=>{N(e.target.value),C(1)},className:"border px-2 py-2 rounded",children:[t.jsx("option",{value:"all",children:"All Status"}),t.jsx("option",{value:"active",children:"Active"}),t.jsx("option",{value:"archived",children:"Archived"})]}),t.jsxs("select",{value:b,onChange:e=>{f(e.target.value),C(1)},className:"border px-2 py-2 rounded",children:[t.jsx("option",{value:"all",children:"All Escrow"}),t.jsx("option",{value:"funded",children:"Escrow Funded"}),t.jsx("option",{value:"pending",children:"Escrow Pending"})]}),t.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[t.jsx("input",{type:"checkbox",checked:w,onChange:()=>_((e=>!e)),className:"form-checkbox h-4 w-4"}),"Only Drafts"]}),t.jsx("button",{onClick:()=>k("/agreements/new"),className:"bg-blue-600 text-white font-semibold px-4 py-2 rounded hover:bg-blue-700",children:"+ New Agreement"})]})]}),c?t.jsx("div",{className:"text-center text-blue-600 py-12",children:"Loading agreements…"}):d?t.jsx("div",{className:"text-center text-red-500 py-6",children:d}):0===A.length?t.jsx("div",{className:"text-gray-500",children:"No agreements match your filters."}):t.jsx("div",{className:"overflow-x-auto rounded shadow bg-white",children:t.jsxs("table",{className:"min-w-full text-sm text-gray-700",children:[t.jsx("thead",{className:"bg-gray-100 text-left",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-2 px-4",children:"Agreement ID"}),t.jsx("th",{className:"py-2 px-4",children:"Project"}),t.jsx("th",{className:"py-2 px-4",children:"Homeowner"}),t.jsx("th",{className:"py-2 px-4",children:"Start"}),t.jsx("th",{className:"py-2 px-4",children:"End"}),t.jsx("th",{className:"py-2 px-4",children:"Total"}),t.jsx("th",{className:"py-2 px-4",children:"Escrow"}),t.jsx("th",{className:"py-2 px-4",children:"Invoices"}),t.jsx("th",{className:"py-2 px-4",children:"Action"})]})}),t.jsx("tbody",{children:E.map((e=>{var s,a,l,n;return t.jsxs("tr",{className:"hover:bg-gray-50",children:[t.jsxs("td",{className:"py-2 px-4 font-mono text-blue-600 cursor-pointer underline",onClick:()=>k(`/agreements/${e.id}`),children:["#",e.id,!e.signed_by_contractor&&t.jsx("span",{className:"ml-2 text-xs text-yellow-700 bg-yellow-100 px-2 py-0.5 rounded-full",children:"Draft"})]}),t.jsx("td",{className:"py-2 px-4",children:e.project_name||e.project_title||"-"}),t.jsx("td",{className:"py-2 px-4",children:e.homeowner_name||(null==(s=e.homeowner)?void 0:s.name)||"-"}),t.jsx("td",{className:"py-2 px-4",children:e.start_date||"—"}),t.jsx("td",{className:"py-2 px-4",children:e.end_date||"—"}),t.jsxs("td",{className:"py-2 px-4",children:["$",parseFloat(e.total_cost||0).toLocaleString(void 0,{minimumFractionDigits:2})]}),t.jsx("td",{className:"py-2 px-4",children:t.jsx("span",{className:"px-2 py-1 rounded text-white "+(e.escrow_funded?"bg-green-500":"bg-yellow-500"),children:e.escrow_funded?"Funded":"Pending"})}),t.jsx("td",{className:"py-2 px-4",children:t.jsxs("button",{onClick:()=>{return s=e.milestone_invoices,e.id,m(s||[]),j("Agreement"),void p(!0);var s},className:"text-blue-500 hover:underline "+((null==(a=e.milestone_invoices)?void 0:a.length)?"":"opacity-50 cursor-default"),disabled:!(null==(l=e.milestone_invoices)?void 0:l.length),children:[(null==(n=e.milestone_invoices)?void 0:n.length)||0," Invoices"]})}),t.jsx("td",{className:"py-2 px-4",children:!e.signed_by_contractor&&t.jsx("button",{onClick:()=>k(`/agreements/new?id=${e.id}`),className:"text-blue-600 hover:underline text-sm",children:"Continue Editing"})})]},e.id)}))})]})}),P>1&&t.jsxs("div",{className:"flex justify-between items-center mt-6",children:[t.jsxs("p",{className:"text-sm text-gray-500",children:["Page ",S," of ",P]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{disabled:1===S,onClick:()=>C((e=>e-1)),className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50",children:"Prev"}),t.jsx("button",{disabled:S===P,onClick:()=>C((e=>e+1)),className:"px-3 py-1 bg-gray-200 rounded disabled:opacity-50",children:"Next"})]})]}),t.jsx(a,{visible:h,onClose:()=>{p(!1)},invoices:x,category:u})]})}export{n as default};
