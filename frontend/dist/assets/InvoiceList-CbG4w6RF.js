import{R as e,r as t,a as r,V as n,j as o,L as a}from"./index-DaD-43PJ.js";var s={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},i=e.createContext&&e.createContext(s),c=["attr","size","title"];function l(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d.apply(this,arguments)}function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e,t,r){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?n:n+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function x(t){return t&&t.map(((t,r)=>e.createElement(t.tag,m({key:r},t.attr),x(t.child))))}function b(t){return r=>e.createElement(f,d({attr:m({},t.attr)},r),x(t.child))}function f(t){var r=r=>{var n,{attr:o,size:a,title:s}=t,i=l(t,c),u=a||r.size||"1em";return r.className&&(n=r.className),t.className&&(n=(n?n+" ":"")+t.className),e.createElement("svg",d({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,o,i,{className:n,style:m(m({color:t.color||r.color},r.style),t.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),s&&e.createElement("title",null,s),t.children)};return void 0!==i?e.createElement(i.Consumer,null,(e=>r(e))):r(s)}function g(e){return b({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"},child:[]}]})(e)}function v(e){return b({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"},child:[]}]})(e)}function y(e){return b({attr:{fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true"},child:[{tag:"path",attr:{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},child:[]}]})(e)}const h=({invoice:e,statusStyles:t})=>{const s=parseFloat(e.amount||0).toLocaleString("en-US",{style:"currency",currency:"USD"}),i=e.status.charAt(0).toUpperCase()+e.status.slice(1);return o.jsxs("div",{className:"bg-white shadow-sm rounded-lg p-4 flex justify-between items-center hover:bg-gray-50 transition-colors",children:[o.jsx(a,{to:`/invoices/${e.id}`,"aria-label":`Invoice ${e.invoice_number} for ${e.homeowner_name}`,className:"flex-1",children:o.jsxs("div",{children:[o.jsx("div",{className:"font-semibold text-gray-800",children:e.invoice_number}),o.jsxs("div",{className:"text-sm text-gray-600",children:["For Homeowner: ",e.homeowner_name]})]})}),o.jsxs("div",{className:"text-right flex items-center space-x-3",children:[o.jsx("div",{className:"font-semibold text-lg text-gray-900",children:s}),o.jsx("span",{className:`px-3 py-1 text-xs font-medium rounded-full ${t[e.status]||"bg-gray-200 text-gray-800"}`,children:i}),o.jsx("button",{onClick:async t=>{t.stopPropagation();try{const t=await r.get(`/invoices/${e.id}/pdf/`,{responseType:"blob"}),n=window.URL.createObjectURL(new Blob([t.data])),o=document.createElement("a");o.href=n,o.setAttribute("download",`invoice_${e.invoice_number}.pdf`),document.body.appendChild(o),o.click(),o.remove()}catch{n.error("Failed to download invoice PDF.")}},title:"Download PDF",className:"text-blue-600 hover:text-blue-800",children:o.jsx(y,{size:18})})]})]})};function j(){const[e,a]=t.useState([]),[s,i]=t.useState(!0),[c,l]=t.useState(""),[d,u]=t.useState(""),[m,p]=t.useState({}),x=t.useCallback((async()=>{i(!0);try{const{data:e}=await r.get("/invoices/");a(e);const t=e.reduce(((e,t)=>(e[t.agreement]=!0,e)),{});p(t)}catch(e){l("Failed to load invoices."),n.error("Could not load invoices.")}finally{i(!1)}}),[]);t.useEffect((()=>{x()}),[x]);const b=t.useMemo((()=>{if(!d)return e;const t=d.trim().toLowerCase();return e.filter((e=>(e.project_title||"").toLowerCase().includes(t)||(e.homeowner_name||"").toLowerCase().includes(t)||(e.invoice_number||"").toLowerCase().includes(t)))}),[e,d]),f=t.useMemo((()=>b.reduce(((e,t)=>{const r=t.agreement;return e[r]||(e[r]={agreementId:r,projectTitle:t.project_title,items:[]}),e[r].items.push(t),e}),{})),[b]),y={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",disputed:"bg-red-100 text-red-800",paid:"bg-green-100 text-green-800",incomplete:"bg-gray-100 text-gray-800"};return s?o.jsx("div",{className:"p-6 text-center text-gray-500",children:"Loading invoices..."}):o.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[o.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-6",children:[o.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"Invoices"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("input",{type:"text",placeholder:"Search by project, customer, or invoice #",value:d,onChange:e=>u(e.target.value),className:"border px-4 py-2 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500"}),o.jsx("button",{onClick:x,className:"text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded",children:"Refresh"})]})]}),c&&o.jsx("p",{className:"text-red-500 mb-4 text-center",children:c}),0===Object.keys(f).length&&!c&&o.jsx("p",{className:"text-gray-500 text-center py-10",children:"No invoices found."}),o.jsx("div",{className:"space-y-6",children:Object.values(f).map((e=>o.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[o.jsxs("button",{onClick:()=>{return t=e.agreementId,void p((e=>({...e,[t]:!e[t]})));var t},className:"w-full flex justify-between items-center text-left text-xl font-semibold mb-2",children:[o.jsx("span",{children:e.projectTitle}),m[e.agreementId]?o.jsx(v,{}):o.jsx(g,{})]}),m[e.agreementId]&&o.jsx("div",{className:"space-y-3 pl-2 border-l-2 border-blue-200 ml-1",children:e.items.map((e=>o.jsx(h,{invoice:e,statusStyles:y},e.id)))})]},e.agreementId)))})]})}export{j as default};
