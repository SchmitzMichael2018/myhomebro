import{r as e,a as t,V as a,j as s}from"./index-DaD-43PJ.js";const n=({agreements:t,onAdd:n,loading:r})=>{const[l,d]=e.useState({agreement:"",description:"",amount:"",incurred_date:(new Date).toISOString().split("T")[0]}),i=e=>{const{name:t,value:a}=e.target;d((e=>({...e,[t]:a})))};return s.jsxs("form",{onSubmit:async e=>{e.preventDefault(),l.agreement?(await n(l),d({agreement:"",description:"",amount:"",incurred_date:(new Date).toISOString().split("T")[0]})):a.error("Please select an agreement.")},className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-5 gap-4 mb-8 p-4 bg-gray-50 rounded-lg",children:[s.jsxs("select",{name:"agreement",value:l.agreement,onChange:i,className:"form-input md:col-span-2",required:!0,children:[s.jsx("option",{value:"",children:"-- Select an Agreement --"}),t.map((e=>s.jsxs("option",{value:e.id,children:["#",e.id," - ",e.project.title]},e.id)))]}),s.jsx("input",{name:"description",placeholder:"Expense Description",value:l.description,onChange:i,className:"form-input",required:!0}),s.jsx("input",{name:"amount",type:"number",step:"0.01",placeholder:"Amount",value:l.amount,onChange:i,className:"form-input",required:!0}),s.jsx("input",{name:"incurred_date",type:"date",value:l.incurred_date,onChange:i,className:"form-input",required:!0}),s.jsx("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 md:col-span-5",children:r?"Adding...":"+ Add Expense"})]})};function r(){const[r,l]=e.useState([]),[d,i]=e.useState([]),[c,o]=e.useState(!0),[m,p]=e.useState(""),[u,x]=e.useState(!1),g=e.useCallback((async()=>{o(!0),p("");try{const[e,a]=await Promise.all([t.get("/expenses/"),t.get("/agreements/")]);l(e.data),i(a.data)}catch(e){const t="Failed to load page data.";p(t),a.error(t)}finally{o(!1)}}),[]);e.useEffect((()=>{g()}),[g]);return c?s.jsx("p",{className:"p-6 text-center",children:"Loading expenses..."}):m?s.jsx("p",{className:"p-6 text-center text-red-500",children:m}):s.jsxs("div",{className:"max-w-4xl mx-auto p-6",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6 text-gray-800",children:"Track Expenses"}),s.jsx(n,{agreements:d,onAdd:async e=>{var s,n;x(!0);try{const s=`/agreements/${e.agreement}/expenses/`;await t.post(s,e),a.success("Expense added successfully!"),g()}catch(r){a.error((null==(n=null==(s=r.response)?void 0:s.data)?void 0:n.detail)||"Failed to add expense.")}finally{x(!1)}},loading:u}),s.jsx("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-3 text-left font-semibold text-gray-600",children:"Project"}),s.jsx("th",{className:"p-3 text-left font-semibold text-gray-600",children:"Description"}),s.jsx("th",{className:"p-3 text-right font-semibold text-gray-600",children:"Amount"}),s.jsx("th",{className:"p-3 text-center font-semibold text-gray-600",children:"Date Incurred"})]})}),s.jsx("tbody",{className:"divide-y divide-gray-200",children:0===r.length?s.jsx("tr",{children:s.jsx("td",{colSpan:"4",className:"text-center py-8 text-gray-500",children:"No expenses logged yet."})}):r.map((e=>s.jsxs("tr",{children:[s.jsx("td",{className:"p-3",children:e.project_title||"N/A"}),s.jsx("td",{className:"p-3",children:e.description}),s.jsx("td",{className:"p-3 text-right font-semibold",children:parseFloat(e.amount).toLocaleString("en-US",{style:"currency",currency:"USD"})}),s.jsx("td",{className:"p-3 text-center",children:e.incurred_date})]},e.id)))})]})})]})}export{r as default};
